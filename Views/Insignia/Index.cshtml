@model List<EmPoderTIC.Models.AREA>

@{
    ViewBag.Title = "Reconocimiento de Insignias - EmPoderTIC";
}


@if (Session["TipoPerfil"] != null && Session["TipoPerfil"].ToString() == "Estudiante y/o Titulado")
{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
else
{
    Layout = "~/Views/Shared/_LayoutGeneral.cshtml";
}


@if (Session["TipoPerfil"] != null && Session["TipoPerfil"].ToString() == "Estudiante y/o Titulado")
{

    <link rel="stylesheet" href="~/Content/css/insignias.css">


    <div id="header">
        <h1>Reconocimiento de Insignias - EmPoderTIC</h1>
        <!-- Filtro por Área de interés -->
        <div class="filtro-area-interes">
            <label for="area-interes">Filtrar por Área de interés:</label>
            <select id="area-interes">
                <option value="todos">Todos</option>
                @foreach (var area in Model)
                {
                    var NombreArea = area.area_conocimiento;
                    <option value="@NombreArea">@NombreArea</option>
                }
            </select>
        </div>

        <!-- Contenedor de las insignias -->
        <div class="insignias-container">
            @foreach (var area in Model)
            {
                var NombreArea = area.area_conocimiento; // Obtener el nombre del área actual

                <!-- Mini contenedor por área -->
                <div class="mini-container" data-area="@NombreArea">
                    <h2>Área de participación en Talleres y eventos de @NombreArea</h2>
                    <!-- Tu contenido dentro del mini contenedor -->
                    <div class="insignias">
                        @foreach (var INSIGNIA in area.INSIGNIA)
                        {
                            <div class="columna-insignia @(INSIGNIA.insignia_bloqueada ? "bloqueada" : "")">
                                <div class="insignia-progreso">
                                    @if (!INSIGNIA.insignia_bloqueada)
                                    {
                                        <!-- Aplicar filtro gris a la imagen si ninguna ASISTENCIA tiene registro_asistencia_evento como false -->
                                        <img src="@INSIGNIA.imagen_url" alt="@INSIGNIA.nombre" class="insignia-imagen">
                                        <div class="check-circulo">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    }
                                    else
                                    {
                                        <!-- Mostrar la imagen normal si al menos una ASISTENCIA tiene registro_asistencia_evento como true -->
                                        <img src="@INSIGNIA.imagen_url" alt="@INSIGNIA.nombre" class="insignia-imagen grayscale">
                                        <div class="check-circulo grayscale">
                                            <i class="fas fa-check grayscale"></i>
                                        </div>
                                    }
                                </div>
                                <div class="insignias-titulos">
                                    <h3>@INSIGNIA.nombre</h3>
                                    <h4>@ViewBag.Niveles[INSIGNIA.NIVEL_nivel_id]</h4>
                                    <p>@INSIGNIA.descripción</p>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="btn-certificado">
                        <br />
                        <br />
                        @if (!ViewBag.AreasBloqueadas.Contains(NombreArea) && !string.IsNullOrEmpty(ViewBag.CertificadoURL))
                        {
                            <!-- El botón se muestra como activo si el área no está bloqueada y hay un certificado disponible -->
                            <a href="@ViewBag.CertificadoURL" class="btn" id="obtener-certificado" target="_blank">OBTENER CERTIFICADO</a>
                        }
                        else
                        {
                            <!-- El botón se muestra como inactivo si el área está bloqueada o no hay certificado disponible -->
                            <button class="btn btn-inactivo" id="obtener-certificado" style="background-color: #888; color: #fff;" disabled>OBTENER CERTIFICADO</button>
                        }
                    </div>
                </div>
            }
        </div>
    </div>

    <script src="~/Content/js/reconocimiento.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Filtrar por Área de interés
            $("#area-interes").change(function () {
                var selectedArea = $(this).val();

                // Ocultar todos los mini-contenedores
                $(".mini-container").hide();

                if (selectedArea === "todos") {
                    // Mostrar todos los mini-contenedores si se selecciona "todos"
                    $(".mini-container").show();
                } else {
                    // Mostrar solo los mini-contenedores que coincidan con el área seleccionada
                    $(".mini-container[data-area='" + selectedArea + "']").show();
                }
            });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Aplicar filtro de color gris a las imágenes bloqueadas
            $(".insignia-imagen.grayscale").css("filter", "grayscale(100%)");
            $(".insignia-imagen.grayscale").css("-webkit-filter", "grayscale(100%)");
            $(".check-circulo.grayscale").css("filter", "grayscale(100%)");
            $(".check-circulo.grayscale").css("-webkit-filter", "grayscale(100%)");
        });
    </script>
}
else
{
    <link rel="stylesheet" href="~/Content/css/accesodenegado.css">
    <div id="header">
        <h1> Acceso denegado. Esta vista solo está disponible para estudiantes</h1>
        <br />
        <a href="@Url.Action("Login", "Account")" class="btn-acceso">Iniciar Sesión</a>
    </div>
}